{
  "file_map": [
    {
      "path": "src/app/(main)/layout.tsx",
      "tags": [],
      "purpose": "Defines the global HTML shell for the entire Next.js application.",
      "summary": "This component wraps all pages with shared UI and context providers. It renders the <ConfiguratorProvider> (from 'core') to make the global state available everywhere. It also renders the persistent <AppHeader> (from 'features') and the global <Toaster> (from 'components/ui').",
      "relations": "- This is the root of the React component tree. - Imports `ConfiguratorProvider` from `src/core/state/ConfiguratorContext.tsx`. - Imports `AppHeader` from `src/features/header/AppHeader.tsx`. - Imports `Toaster` from `src/components/ui/toaster.tsx`.",
      "imports": "- Metadata from 'next' - ./globals.css - Toaster from '@/components/ui/toaster' - AppHeader from '@/features/header/AppHeader' - ConfiguratorProvider from '@/core/state/ConfiguratorContext'"
    },
    {
      "path": "src/app/(main)/page.tsx",
      "tags": [],
      "purpose": "Defines the main page layout, handling the responsive display of the Configurator and Chat components.",
      "summary": "This component implements the application's primary responsive UI. - On mobile, it uses a state variable ('activeTab') to render tab buttons and toggle between <Configurator /> and <ChatCoPilot />. - On desktop, it switches to a 2-column layout, displaying the main <Configurator /> component and a sticky <ChatCoPilot /> sidebar.",
      "relations": "- This is the main page component rendered inside `src/app/layout.tsx`. - It imports and arranges the two core feature pillars: - `Configurator` from `src/features/configurator/Configurator.tsx`. - `ChatCoPilot` from `src/features/chat/ChatCoPilot.tsx`.",
      "imports": "- useState from 'react' - ChatCoPilot from '@/features/chat/ChatCoPilot' - Configurator from '@/features/configurator/Configurator'"
    },
    {
      "path": "src/app/api/chat/route.ts",
      "tags": [],
      "purpose": "The server-side API endpoint for the chat feature.",
      "summary": "This file defines the POST request handler for `/api/chat`. It receives the `userInput` from the client (`ChatCoPilot.tsx`), calls the `extractAttributesFromText` function from the Genkit engine, and returns the resulting JSON \"form\" to the client.",
      "relations": "- This is the \"API mailman.\" - It imports and calls the `extractAttributesFromText` function from `src/core/ai/genkit.ts`. - It is called via `fetch` by `src/features/chat/ChatCoPilot.tsx`.",
      "imports": "- NextResponse from 'next/server' - extractAttributesFromText from '@/core/ai/genkit'"
    },
    {
      "path": "src/components/ui/button.tsx",
      "tags": [],
      "purpose": "Provides a highly customizable and reusable Button component for the application's design system, using CVA.",
      "summary": "This file defines the core `Button` component, which is a foundational UI primitive. Styling is managed using CVA to allow for different `variant` and `size` options.",
      "relations": "- This is a foundational UI primitive. - It is imported by components like `src/features/header/ui/ResetButton.tsx`. - It relies on the class utility function imported from `src/lib/utils.ts`.",
      "imports": "- React - Slot from '@radix-ui/react-slot' - cva, type VariantProps from 'class-variance-authority' - cn from '@/lib/utils'"
    },
    {
      "path": "src/components/ui/card.tsx",
      "tags": [],
      "purpose": "To provide a flexible, styled, multi-part card component for the application's design system.",
      "summary": "This file defines a set of reusable, composable Card components: `Card`, `CardHeader`, `CardTitle`, `CardDescription`, `CardContent`, and `CardFooter`. Each component uses `React.forwardRef` and imports the `cn()` utility to merge default Tailwind styles with any custom `className` props.",
      "relations": "- This is a foundational UI primitive. - It is imported by components across all features, such as `src/features/configurator/ui/OptionCard.tsx`. - It imports the `cn` utility function from `src/lib/utils.ts`.",
      "imports": "- React from \"react\" - cn from \"@/lib/utils\"",
      "exports": "- Card (React component) - CardHeader (React component) - CardFooter (React component) - CardTitle (React component) - CardDescription (React component) - CardContent (React component)"
    },
    {
      "path": "src/components/ui/toast.tsx",
      "tags": [],
      "purpose": "Defines all foundational components for displaying temporary, dismissible, global notifications (toasts).",
      "summary": "This file provides the full suite of UI components necessary for toast notifications, based on Radix UI. It includes `ToastProvider`, `ToastViewport`, `Toast` (the container), `ToastTitle`, `ToastDescription`, `ToastAction`, and `ToastClose`.",
      "relations": "- This is a foundational UI primitive. - It is imported by `src/components/ui/toaster.tsx` (the renderer) and `src/hooks/use-toast.ts` (for types). - It imports the `cn` utility function from `src/lib/utils.ts`.",
      "imports": "- React - ToastPrimitives from '@radix-ui/react-toast' - cva, type VariantProps from 'class-variance-authority' - X from 'lucide-react' - cn from '@/lib/utils'"
    },
    {
      "path": "src/components/ui/toaster.tsx",
      "tags": [],
      "purpose": "The global container component responsible for rendering and managing all active toast notifications.",
      "summary": "This component is rendered once in the root layout. It imports the `useToast` hook to get the list of active toasts. It then maps over this array and renders each toast using the primitive components (Toast, ToastTitle, etc.).",
      "relations": "- This is the \"renderer\" for the toast system. - It is imported by `src/app/layout.tsx`. - It consumes the state from `src/hooks/use-toast.ts`. - It imports its building blocks from `src/components/ui/toast.tsx`.",
      "imports": "- useToast from '@/hooks/use-toast' - { Toast, ToastClose, ... } from '@/components/ui/toast'"
    },
    {
      "path": "src/core/ai/genkit.ts",
      "tags": [],
      "purpose": "Configure Genkit/Gemini to act as a structured JSON \"form-filler\" AND Q&A assistant.",
      "summary": "Initializes Gemini 2.5-flash and defines `extractAttributesFromText`.",
      "relations": "- This is the \"Dual-Task AI\" logic. - It reads its Q&A data from `./aiKnowledgeBase.yaml` (co-located). - It is imported and called by the API route at `src/app/api/chat/route.ts`. - It provides the `ExtractedFacets` type, which is used by `src/core/state/ConfiguratorContext.tsx`.",
      "imports": "- genkit (core client) - googleAI (Gemini plugin) - z (Zod for schema definition) - fs, path (Node.js for reading the Knowledge Base)"
    },
    {
      "path": "src/core/engine/configuratorEngine.ts",
      "tags": [],
      "purpose": "The new \"Smarter Brain\" for the Configurator. Contains all auto-skip and filtering logic.",
      "summary": "Defines the question order/labels and exports the main function, `calculateNextUiState`. This function filters the imported PRODUCT_CATALOG based on user selections and applies the (0, 1, 1) rules.",
      "relations": "- This is the \"Smarter Brain\" logic. - It imports its data from `src/core/engine/productDatabase.ts`. - It is imported and used by `src/core/state/ConfiguratorContext.tsx`.",
      "imports": "- ProductType, PRODUCT_CATALOG from '@/core/engine/productDatabase'",
      "exports": "- Product (type) - Option (type) - FacetAttribute (type) - QuestionState (type) - EngineResult (type) - FACET_ORDER (const) - FACET_DEFINITIONS (const) - calculateNextUiState (function) - formatFacetLabelForDisplay (function)"
    },
    {
      "path": "src/core/engine/productDatabase.ts",
      "tags": [],
      "purpose": "Defines the Product type and exports the product catalog (our \"database\").",
      "summary": "Contains the Product data type, the BASE_PRODUCT_URL constant, and the complete PRODUCT_CATALOG array. This file is the single source of truth for all product data.",
      "relations": "- This is the \"data\" layer for the configurator engine. - It is imported by `src/core/engine/configuratorEngine.ts`.",
      "exports": "- Product (type) - BASE_PRODUCT_URL (constant) - PRODUCT_CATALOG (constant)"
    },
    {
      "path": "src/core/persistence/chatService.ts",
      "tags": [],
      "purpose": "To centralize all database read/write interactions for chat history.",
      "summary": "This file abstracts all Firestore logic for the chat feature. It provides functions to load/save the parent session (contact info) and the messages subcollection. The `saveMessage` function now accepts and stores the message `variant` to ensure UI consistency on reload (e.g., for 'whatsapp-link' bubbles).",
      "relations": "- Imports the `db` instance from `./firebase.ts`. - Imports types from `./types.ts`. - This file is imported by `src/features/chat/ChatCoPilot.tsx` to load and save its messages.",
      "imports": "- db from './firebase' - ChatMessage, ChatSession from './types' - firebase/firestore functions"
    },
    {
      "path": "src/core/persistence/firebase.ts",
      "tags": [],
      "purpose": "To initialize and configure the connection to the Firebase/Firestore backend.",
      "summary": "This file initializes the Firebase app using environment variables and exports the Firestore database instance (`db`). It critically calls `enableIndexedDbPersistence` to ensure the chat history is cached locally, enabling robust offline-first capabilities.",
      "relations": "- This is the root of the persistence layer. - The exported `db` instance is imported by `src/core/persistence/chatHistory.ts` to perform read/write operations.",
      "imports": "- initializeApp from 'firebase/app' - getFirestore, enableIndexedDbPersistence from 'firebase/firestore'"
    },
    {
      "path": "src/core/state/ConfiguratorContext.tsx",
      "tags": [],
      "purpose": "Centralize and expose configurator state using the new Smart Engine.",
      "summary": "Manages the `selectedOptions` Master List (the single source of truth) and calls `calculateNextUiState` whenever selections change. Provides public functions for manual clicks (`setAttribute`) and AI batch updates (`applyExtractedFacets`).",
      "relations": "- This is the \"State Manager,\" the heart of the app's interactivity. - It imports its logic from `src/core/engine/configuratorEngine.ts`. - It imports the AI's output type from `src/core/ai/genkit.ts`. - It is imported by `src/app/layout.tsx` (to wrap the app). - Its hook (`useConfiguratorContext`) is consumed by all \"smart\" features (`Configurator.tsx`, `ChatCoPilot.tsx`, `AppHeader.tsx`).",
      "imports": "- React hooks - calculateNextUiState, FACET_ORDER, formatFacetLabelForDisplay, etc. from '@/core/engine/configuratorEngine' - ExtractedFacets from '@/core/ai/genkit'"
    },
    {
      "path": "src/features/chat/ChatCoPilot.tsx",
      "tags": [],
      "purpose": "The \"smart\" controller for the AI Chat feature (Pillar 2).",
      "summary": "This is the \"chat logic folder.\" It connects to the core logic, manages all chat state (loading, message history), and orchestrates the \"Answer-then-Question\" sequence. It consumes the ConfiguratorContext, calls the AI API, and orchestrates persistence by passing complete message objects (including `variant`) to the `chatHistory` service. It passively saves contact info, actively prompts for it, and handles the \"talk to human\" handover flow. This file contains bug fixes for the handover flow logic.",
      "relations": "- It is the \"smart\" parent for this feature. - It is imported by `src/app/page.tsx`. - Consumes `useConfiguratorContext` from `src/core/state/ConfiguratorContext.tsx`. - Imports persistence functions from `src/core/persistence/chatHistory.ts`. - Imports types from `src/core/persistence/types.ts` and `src/core/ai/genkit.ts`. - Renders its \"dumb\" children: `./ui/ChatDisplay.tsx` and `./ui/ChatInput.tsx`.",
      "imports": "- React hooks - Core Context: useConfiguratorContext - Core AI types: ExtractedFacets - Core Persistence: loadSession, saveMessage, createSession, ChatMessage, ChatSession, saveInitialSession, updateSessionContactInfo - UI Components: ChatDisplay, ChatInput - { generateWhatsAppLink } from '@/lib/utils' - { FACET_ORDER } from '@/core/engine/configuratorEngine'"
    },
    {
      "path": "src/features/chat/ui/ChatBubble.tsx",
      "tags": [],
      "purpose": "A \"dumb\" visual component to render a single chat message bubble.",
      "summary": "This component receives a full `ChatMessage` object. It renders a styled bubble based on the `message.variant`: - 'incoming': Standard bot reply. - 'outgoing': Standard user reply. - 'loading': Renders the `ChatLoader`. - 'whatsapp-link': Renders a clickable \"Iniciar Conversa\" button.",
      "relations": "- This is a \"dumb\" UI component. - It is imported and rendered by `src/features/chat/ui/ChatDisplay.tsx`. - It imports its child component, `src/features/chat/ui/ChatLoader.tsx`.",
      "imports": "- React - ChatLoader from './ChatLoader' - ChatMessage from '@/core/persistence/types' - MessageCircle from 'lucide-react'"
    },
    {
      "path": "src/features/chat/ui/ChatDisplay.tsx",
      "tags": [],
      "purpose": "A \"dumb\" visual component to render the scrollable message display area.",
      "summary": "This component maps over the provided `messages` array and renders each as a `ChatBubble` component. It includes a `useEffect` hook that auto-scrolls the view to the bottom (to the `messagesEndRef`) whenever the 'messages' prop is updated. This file was updated to pass the correct 'message' object prop to its child.",
      "relations": "- This is a \"dumb\" UI component. - It is imported and rendered by the \"smart\" `src/features/chat/ChatCoPilot.tsx`. - It imports its child component, `src/features/chat/ui/ChatBubble.tsx`. - It uses the `ChatMessage` type from `src/core/persistence/types.ts`.",
      "imports": "- React (useRef, useEffect) - ChatBubble from './ChatBubble' - type ChatMessage from '@/core/persistence/types'"
    },
    {
      "path": "src/features/chat/ui/ChatInput.tsx",
      "tags": [],
      "purpose": "A \"dumb\" visual component for the chat input field and send button.",
      "summary": "This is a controlled component that receives an `onSendMessage` callback and an `isLoading` boolean. The `isLoading` prop disables the input and button while the AI is processing. It manages its own internal text state.",
      "relations": "- This is a \"dumb\" UI component. - It is imported and rendered by the \"smart\" `src/features/chat/ChatCoPilot.tsx`.",
      "imports": "- React (useState) - lucide-react (Send icon)"
    },
    {
      "path": "src/features/chat/ui/ChatLoader.tsx",
      "tags": [],
      "purpose": "Renders a \"fading blocks\" loading animation.",
      "summary": "This is a self-contained \"dumb\" component with its own <style> tag for the keyframe animations. It is imported by ChatBubble.tsx to be displayed when the AI is thinking.",
      "relations": "- This is a \"dumb\" UI component. - It is imported and rendered by `src/features/chat/ui/ChatBubble.tsx`.",
      "imports": "- React"
    },
    {
      "path": "src/features/configurator/Configurator.tsx",
      "tags": [],
      "purpose": "The \"smart\" controller for the Configurator feature (Pillar 1).",
      "summary": "This is the \"configurator logic folder.\" It consumes the ConfiguratorContext to get the current state. It then decides whether to render the final `ResultCard` (if the flow is finished) or the `QuestionDisplay` (if the flow is ongoing).",
      "relations": "- It is the \"smart\" parent for this feature. - It is imported by `src/app/page.tsx`. - It consumes state from `src/core/state/ConfiguratorContext.tsx`. - It imports its \"dumb\" children from `./ui/QuestionDisplay.tsx` and `./ui/ResultCard.tsx`. - It imports data from `src/core/engine/productDatabase.ts`.",
      "imports": "- useConfiguratorContext from '@/core/state/ConfiguratorContext' - BASE_PRODUCT_URL from '@/core/engine/productDatabase' - QuestionDisplay from './ui/QuestionDisplay' - ResultCard from './ui/ResultCard'"
    },
    {
      "path": "src/features/configurator/ui/OptionCard.tsx",
      "tags": [],
      "purpose": "A \"dumb\" visual component for a single clickable configuration option.",
      "summary": "This component receives an `option` object (with label, value, picture) and an `onClick` function via props. It renders a clickable Card primitive, displaying the option's image and label.",
      "relations": "- This is a \"dumb\" UI component. - It is imported and rendered by `src/features/configurator/ui/QuestionDisplay.tsx`. - It imports the `Option` type from `src/core/engine/configuratorEngine.ts`. - It imports the `Card` primitive from `src/components/ui/card.tsx`.",
      "imports": "- Image from 'next/image' - { Card } from '@/components/ui/card' - { type Option } from '@/core/engine/configuratorEngine'"
    },
    {
      "path": "src/features/configurator/ui/QuestionDisplay.tsx",
      "tags": [],
      "purpose": "A \"dumb\" visual component to display the current question and its options.",
      "summary": "This component receives all its data via props. It renders the question title and then maps over the `options` array, rendering an `OptionCard` for each one. It attaches the `onOptionClick` handler to each card.",
      "relations": "- This is a \"dumb\" UI component. - It is imported and rendered by the \"smart\" `src/features/configurator/Configurator.tsx`. - It imports and renders its own child, `src/features/configurator/ui/OptionCard.tsx`. - It uses the `Option` type from the core engine.",
      "imports": "- OptionCard from './OptionCard' - type Option from '@/core/engine/configuratorEngine'"
    },
    {
      "path": "src/features/configurator/ui/ResultCard.tsx",
      "tags": [],
      "purpose": "A \"dumb\" visual component to display the final selected product.",
      "summary": "This component receives a `product` object via props (containing label, picture, and url). It renders a large card with the product image, its full name, a \"Ver Pre√ßo\" button, and a new \"Chat on WhatsApp\" button.",
      "relations": "- This is a \"dumb\" UI component. - It is imported and rendered by the \"smart\" `src/features/configurator/Configurator.tsx`. - It imports primitives from `src/components/ui/card.tsx` and `src/components/ui/button.tsx`. - It imports `generateWhatsAppLink` from `src/lib/utils.ts`.",
      "imports": "- Image from 'next/image' - { Card, CardContent } from '@/components/ui/card' - { Button } from '@/components/ui/button' - { generateWhatsAppLink } from '@/lib/utils' - { MessageCircle } from 'lucide-react'"
    },
    {
      "path": "src/features/header/AppHeader.tsx",
      "tags": [],
      "purpose": "The \"smart\" controller for the application's persistent header bar.",
      "summary": "This component consumes the ConfiguratorContext to get the `fullProductName` string (for the breadcrumbs) and the `reset` function (for the reset button). It then passes this data down as props to its \"dumb\" visual children.",
      "relations": "- This is the \"smart\" parent for this feature. - It is imported by `src/app/layout.tsx`. - It consumes state from `src/core/state/ConfiguratorContext.tsx`. - It imports its \"dumb\" children from `./ui/Breadcrumb.tsx` and `./ui/ResetButton.tsx`.",
      "imports": "- Image from 'next/image' - useConfiguratorContext from '@/core/state/ConfiguratorContext' - ResetButton from './ui/ResetButton' - Breadcrumb from './ui/Breadcrumb'"
    },
    {
      "path": "src/features/header/ui/Breadcrumb.tsx",
      "tags": [],
      "purpose": "A \"dumb\" visual component that renders a breadcrumb trail.",
      "summary": "This component receives a `history` array of strings via props. It maps over the array, separating items with a ChevronRight icon and highlighting the last item as the current step.",
      "relations": "- This is a \"dumb\" UI component. - It is imported and rendered by the \"smart\" `src/features/header/AppHeader.tsx`.",
      "imports": "- lucide-react (ChevronRight icon)"
    },
    {
      "path": "src/features/header/ui/ResetButton.tsx",
      "tags": [],
      "purpose": "A \"dumb\" visual component for the \"Reset\" button.",
      "summary": "This component receives an `onReset` function via props. It renders the global `Button` primitive with a \"ghost\" style and an icon. When clicked, it executes the `onReset` prop.",
      "relations": "- This is a \"dumb\" UI component. - It is imported and rendered by the \"smart\" `src/features/header/AppHeader.tsx`. - It imports the `Button` primitive from `src/components/ui/button.tsx`.",
      "imports": "- { Button } from '@/components/ui/button' - lucide-react (RefreshCw icon)"
    },
    {
      "path": "src/hooks/use-toast.ts",
      "tags": [],
      "purpose": "Manages the global state for the toast notification system.",
      "summary": "This file implements the core logic for the toast system. It creates a global state (outside React) to hold the list of toasts and a reducer to manage that state.",
      "relations": "- This is the \"logic\" for the toast system. - It is imported by `src/components/ui/toaster.tsx`. - It imports types from `src/components/ui/toast.tsx`.",
      "imports": "- React - { type ToastProps } from '@/components/ui/toast'",
      "exports": "1. `toast()`: A function anyone can call to add a new toast. 2. `useToast()`: A hook that the <Toaster> component uses to subscribe to the list of toasts and render them."
    },
    {
      "path": "src/lib/utils.ts",
      "tags": [],
      "purpose": "Provides common, low-level utility functions for styling and business logic.",
      "summary": "This file exports the `cn()` function for merging Tailwind classes and the `generateWhatsAppLink()` function for creating context-aware WhatsApp message URLs.",
      "relations": "- `cn` is imported by all UI primitives in `src/components/ui/`. - `generateWhatsAppLink` is imported by `ResultCard.tsx` and `ChatCoPilot.tsx`.",
      "imports": "- type ClassValue, clsx from 'clsx' - twMerge from 'tailwind-merge'",
      "exports": "- cn (function) - generateWhatsAppLink (function)"
    },
    {
      "path": "src/src/features/configurator/ConfiguratorTab.tsx",
      "tags": [],
      "purpose": "The \"smart\" layout manager for the configurator feature.",
      "summary": "This component (formerly Configurator.tsx) is the main \"tab\" for the configurator. It consumes the ConfiguratorContext and decides whether to show the current question or the final result. The logic from QuestionDisplay.tsx and ResultCard.tsx has been merged into this file. This component renders *only* its content, and its parent (in page.tsx) handles the scrolling container.",
      "relations": "- This is the \"smart\" parent for the configurator feature. - It is imported by `src/app/page.tsx`. - It consumes state from `src/core/state/ConfiguratorContext.tsx`. - It imports its \"dumb\" child `OptionCard.tsx`.",
      "imports": "- React - useConfiguratorContext from '@/core/state/ConfiguratorContext' - BASE_PRODUCT_URL from '@/core/engine/productDatabase' - OptionCard from '@/features/configurator/ui/OptionCard' - Image from 'next/image' - { Card, CardContent } from '@/components/ui/card' - { Button } from '@/components/ui/button' - { generateWhatsAppLink } from '@/lib/utils' - { MessageCircle } from 'lucide-react' - { type Option, type Product } from '@/core/engine/configuratorEngine'",
      "exports": "- ConfiguratorTab (React component)"
    }
  ]
}